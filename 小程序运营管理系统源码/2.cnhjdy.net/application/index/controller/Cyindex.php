<?php  namespace app\index\controller;
use think\Controller;
use think\Db;
use think\Request;
use think\Session;
use think\View;
class Cyindex extends Base
{
	public function index()
	{
		if(check_login())
		{
			if(powerget())
			{
				$var_5746=input('appletid');
				$var_5747=Db::table('applet')->where('id',$var_5746)->find();
				if(!$var_5747)
				{
					$this->error('找不到对应的小程序！');
				}
				$this->assign('applet',$var_5747);
				$var_5748=Db::table('ims_sudu8_page_food_sj')->where('uniacid',$var_5746)->find();
				if($var_5748['thumb'])
				{
					$var_5748['thumb']=remote($var_5746,$var_5748['thumb'],1);
				}
				$this->assign('bases',$var_5748);
			}
			else
			{
				$var_5749=Session::get('usergroup');
				if($var_5749==1)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/applet');
				}
				if($var_5749==2)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/index');
				}
				if($var_5749==3)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/index');
				}
			}
			return $this->fetch(index);
		}
		else
		{
			$this->redirect('Login/index');
		}
	}
	public function save()
	{
		$var_5751=input('appletid');
		$var_5752=Db::table('ims_sudu8_page_food_sj')->where('uniacid',$var_5751)->find();
		$var_5753=array();
		$var_5754=input('commonuploadpic');
		if($var_5754)
		{
			$var_5753['thumb']=remote($var_5751,$var_5754,2);
		}
		$var_5156=$_POST['notice'];
		if($var_5156)
		{
			$var_5753['notice']=$var_5156;
		}
		$var_99=$_POST['phone'];
		if($var_99)
		{
			$var_5753['phone']=$var_99;
		}
		$var_5755=$_POST['address'];
		if($var_5755)
		{
			$var_5753['address']=$var_5755;
		}
		$var_844=$_POST['tags'];
		if($var_844)
		{
			$var_5753['tags']=$var_844;
		}
		$var_5756=$_POST['name'];
		if($var_5756)
		{
			$var_5753['names']=$var_5756;
		}
		$var_5757=$_POST['score'];
		if($var_5756)
		{
			$var_5753['score']=$var_5757;
		}
		$var_5758=$_POST['times'];
		if($var_5758)
		{
			$var_5753['times']=$var_5758;
		}
		$var_5759=$_POST['fuwu'];
		if($var_5759)
		{
			$var_5753['fuwu']=$var_5759;
		}
		$var_5760=$_POST['qita'];
		if($var_5760)
		{
			$var_5753['qita']=$var_5760;
		}
		$var_5761=input('usname');
		if($var_5761)
		{
			$var_5753['usname']=$var_5761;
		}
		else
		{
			$var_5753['usname']=0;
		}
		$var_5762=input('ustel');
		if($var_5762)
		{
			$var_5753['ustel']=$var_5762;
		}
		else
		{
			$var_5753['ustel']=0;
		}
		$var_83=input('usadd');
		if($var_83)
		{
			$var_5753['usadd']=$var_83;
		}
		else
		{
			$var_5753['usadd']=0;
		}
		$var_5763=input('usdate');
		if($var_5763)
		{
			$var_5753['usdate']=$var_5763;
		}
		else
		{
			$var_5753['usdate']=0;
		}
		$var_967=input('ustime');
		if($var_967)
		{
			$var_5753['ustime']=$var_967;
		}
		else
		{
			$var_5753['ustime']=0;
		}
		$var_5764=Db::table('ims_sudu8_page_food_sj')->where('uniacid',$var_5751)->count();
		if($var_5764>0)
		{
			$var_5752=Db::table('ims_sudu8_page_food_sj')->where('uniacid',$var_5751)->update($var_5753);
		}
		else
		{
			$var_5753['uniacid']=$var_5751;
			$var_5752=Db::table('ims_sudu8_page_food_sj')->insert($var_5753);
		}
		if($var_5752)
		{
			$this->success('商家基本配置更新成功！');
		}
		else
		{
			$this->error('商家基本配置更新失败，没有修改项！');
			exit;
		}
	}
	function onepic_uploade($v_1)
	{
		$var_5766=request()->file($v_1);
		if(isset($var_5766))
		{
			$var_5767=upload_img();
			$var_5768=$var_5766->validate(['ext'=>'jpg,png,gif,jpeg'])->move($var_5767);
			if($var_5768)
			{
				$var_599=ROOT_HOST.'/upimages/'.date('Ymd',time()).'/'.$var_5768->getFilename();
				return $var_599;
			}
		}
	}
	public function getimg()
	{
		$var_5770=$_POST['id'];
		$var_5771=Db::table('image_url')->where('appletid',$var_5770)->select();
		if($var_5771)
		{
			return $var_5771;
		}
	}
	public function del()
	{
		$var_5773=input('id');
		$var_5774=Db::table('image_url')->where('id',$var_5773)->delete();
		if($var_5774)
		{
			return 1;
		}
		else
		{
			$this->error('删除失败！');
		}
	}
}
?>