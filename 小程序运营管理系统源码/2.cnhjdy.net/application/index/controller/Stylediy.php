<?php  namespace app\index\controller;
use think\Controller;
use think\Db;
use think\Request;
use think\Session;
use think\View;
header('Content-type: text/html; charset=utf-8');
class Stylediy extends Base
{
	public function index()
	{
		if(check_login())
		{
			if(powerget())
			{
				$var_7672=input('appletid');
				$var_7673=Db::table('applet')->where('id',$var_7672)->find();
				if(!$var_7673)
				{
					$this->error('找不到对应的小程序！');
				}
				$this->assign('applet',$var_7673);
				$var_7674=Db::table('ims_sudu8_page_base')->where('uniacid',$var_7672)->find();
				if($var_7674['c_b_bg'])
				{
					$var_7674['c_b_bg']=remote($var_7672,$var_7674['c_b_bg'],1);
				}
				if($var_7674['config']==null)
				{
					$var_7674['config']='';
				}
				else
				{
					$var_7674['config']=unserialize($var_7674['config']);
					if(!isset($var_7674['config']['commA']))
					{
						$var_7674['config']['commA']=0;
					}
					if(!isset($var_7674['config']['commAs']))
					{
						$var_7674['config']['commAs']=0;
					}
					if(!isset($var_7674['config']['commP']))
					{
						$var_7674['config']['commP']=0;
					}
					if(!isset($var_7674['config']['commPs']))
					{
						$var_7674['config']['commPs']=0;
					}
					if(!isset($var_7674['config']['serverBtn']))
					{
						$var_7674['config']['serverBtn']=1;
					}
				}
				$this->assign('bases',$var_7674);
			}
			else
			{
				$var_809=Session::get('usergroup');
				if($var_809==1)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/applet');
				}
				if($var_809==2)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/index');
				}
				if($var_809==3)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/index');
				}
			}
			return $this->fetch(index);
		}
		else
		{
			$this->redirect('Login/index');
		}
	}
	public function remote()
	{
		if(check_login())
		{
			if(powerget())
			{
				$var_6215=input('appletid');
				$var_7676=Db::table('applet')->where('id',$var_6215)->find();
				if(!$var_7676)
				{
					$this->error('找不到对应的小程序！');
				}
				$this->assign('applet',$var_7676);
				$var_83=Db::table('ims_sudu8_page_base')->where('uniacid',$var_6215)->field(remote)->find();
				if(!$var_83)
				{
					$var_83[remote]=1;
				}
				$var_7677=Db::table('ims_sudu8_page_remote')->where('uniacid',$var_6215)->where('type',2)->find();
				$var_962=Db::table('ims_sudu8_page_remote')->where('uniacid',$var_6215)->where('type',3)->find();
				$this->assign('base',$var_83);
				$this->assign('remote2',$var_7677);
				$this->assign('remote3',$var_962);
			}
			else
			{
				$var_7678=Session::get('usergroup');
				if($var_7678==1)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/applet');
				}
				if($var_7678==2)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/index');
				}
				if($var_7678==3)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/index');
				}
			}
			return $this->fetch(remote);
		}
		else
		{
			$this->redirect('Login/index');
		}
	}
	public function remotesave()
	{
		$var_7680=input('appletid');
		$var_7681=input(remote);
		if($var_7681==1)
		{
			$var_7682=Db::table('ims_sudu8_page_base')->where('uniacid',$var_7680)->update(array(remote=>$var_7681));
			$var_7683=1;
		}
		else if($var_7681==2)
		{
			$var_7682=Db::table('ims_sudu8_page_base')->where('uniacid',$var_7680)->update(array(remote=>$var_7681));
			$var_7684=array();
			if(input('bucket2'))
			{
				$var_7684['bucket']=input('bucket2');
			}
			else
			{
				$this->error('存储空间名称(Bucket)不能为空');
			}
			if(input('domain2'))
			{
				$var_7684['domain']=input('domain2');
			}
			else
			{
				$this->error('绑定域名（或测试域名）不能为空');
			}
			if(input('ak2'))
			{
				$var_7684['ak']=input('ak2');
			}
			else
			{
				$this->error('AccessKey（AK）不能为空');
			}
			if(input('sk2'))
			{
				$var_7684['sk']=input('sk2');
			}
			else
			{
				$this->error('SecretKey（SK）不能为空');
			}
			$var_7684['type']=$var_7681;
			$var_7685=Db::table('ims_sudu8_page_remote')->where('uniacid',$var_7680)->where('type',2)->find();
			if($var_7685)
			{
				$var_7683=Db::table('ims_sudu8_page_remote')->where('uniacid',$var_7680)->where('type',2)->update($var_7684);
			}
			else
			{
				$var_7684['uniacid']=$var_7680;
				$var_7683=Db::table('ims_sudu8_page_remote')->insert($var_7684);
			}
		}
		else if($var_7681==3)
		{
			$var_7682=Db::table('ims_sudu8_page_base')->where('uniacid',$var_7680)->update(array(remote=>$var_7681));
			$var_7684=array();
			if(input('bucket3'))
			{
				$var_7684['bucket']=input('bucket3');
			}
			else
			{
				$this->error('存储空间名称(Bucket)不能为空');
			}
			if(input('domain3'))
			{
				$var_7684['domain']=input('domain3');
			}
			else
			{
				$this->error('Endpoint（或自定义域名）不能为空');
			}
			if(input('ak3'))
			{
				$var_7684['ak']=input('ak3');
			}
			else
			{
				$this->error('Access Key ID不能为空');
			}
			if(input('sk2'))
			{
				$var_7684['sk']=input('sk2');
			}
			else
			{
				$this->error('Access Key Secret不能为空');
			}
			$var_7684['imgstyle']=input('imgstyle3');
			$var_7684['domainIs']=input('domainIs');
			$var_7684['type']=$var_7681;
			$var_7685=Db::table('ims_sudu8_page_remote')->where('uniacid',$var_7680)->where('type',3)->find();
			if($var_7685)
			{
				$var_7683=Db::table('ims_sudu8_page_remote')->where('uniacid',$var_7680)->where('type',3)->update($var_7684);
			}
			else
			{
				$var_7684['uniacid']=$var_7680;
				$var_7683=Db::table('ims_sudu8_page_remote')->insert($var_7684);
			}
		}
		if($var_7683|| $var_7682)
		{
			$this->success('远程附件设置成功');
		}
		else
		{
			$this->error('远程附件设置失败，没有修改项！');
		}
		$var_7686=input('base_color');
		if($var_7686)
		{
			$var_7684['base_color']='#'.$var_7686;
		}
		$var_7687=input('base_tcolor');
		if($var_7687)
		{
			$var_7684['base_tcolor']=$var_7687;
		}
		$var_905=input('homepage');
		if($var_905)
		{
			$var_7684['homepage']=$var_905;
		}
		$var_7688=input('base_color2');
		if($var_7688)
		{
			$var_7684['base_color2']='#'.$var_7688;
		}
		$var_7689=input('base_color_t');
		if($var_7689)
		{
			$var_7684['base_color_t']='#'.$var_7689;
		}
		$var_7690=Db::table('ims_sudu8_page_base')->where('uniacid',$var_7680)->count();
		if($var_7690>0)
		{
			$var_7683=Db::table('ims_sudu8_page_base')->where('uniacid',$var_7680)->update($var_7684);
		}
		else
		{
			$var_7684['uniacid']=$var_7680;
			$var_7683=Db::table('ims_sudu8_page_base')->insert($var_7684);
		}
		if($var_7683)
		{
			$this->success('基础信息更新成功！');
		}
		else
		{
			$this->error('基础信息更新失败，没有修改项！');
		}
	}
	public function diyset()
	{
		if(check_login())
		{
			if(powerget())
			{
				$var_7692=input('appletid');
				$var_7693=Db::table('applet')->where('id',$var_7692)->find();
				if(!$var_7693)
				{
					$this->error('找不到对应的小程序！');
				}
				$this->assign('applet',$var_7693);
				$var_7694=Db::table('ims_sudu8_page_base')->where('uniacid',$var_7692)->find();
				if(!$var_7694)
				{
					$var_7694='';
				}
				else
				{
					if($var_7694['config']==null)
					{
						$var_7694['config']='';
					}
					else
					{
						$var_7694['config']=unserialize($var_7694['config']);
						if(!isset($var_7694['config']['commA']))
						{
							$var_7694['config']['commA']=0;
						}
						if(!isset($var_7694['config']['commAs']))
						{
							$var_7694['config']['commAs']=0;
						}
						if(!isset($var_7694['config']['commP']))
						{
							$var_7694['config']['commP']=0;
						}
						if(!isset($var_7694['config']['commPs']))
						{
							$var_7694['config']['commPs']=0;
						}
						if(!isset($var_7694['config']['serverBtn']))
						{
							$var_7694['config']['serverBtn']=1;
						}
					}
				}
				$this->assign('bases',$var_7694);
			}
			else
			{
				$var_6649=Session::get('usergroup');
				if($var_6649==1)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/applet');
				}
				if($var_6649==2)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/index');
				}
				if($var_6649==3)
				{
					$this->error('您没有权限操作该小程序或找不到相应小程序！','Applet/index');
				}
			}
			return $this->fetch(diyset);
		}
		else
		{
			$this->redirect('Login/index');
		}
	}
	public function diysetsave()
	{
		$var_3044=input('appletid');
		$var_7696=array();
		$var_7696['uniacid']=input('appletid');
		$var_7697=input('base_color');
		if($var_7697)
		{
			$var_7696['base_color']='#'.$var_7697;
		}
		$var_7698=input('base_tcolor');
		if($var_7698)
		{
			$var_7696['base_tcolor']=$var_7698;
		}
		$var_7699=input('homepage');
		if($var_7699)
		{
			$var_7696['homepage']=$var_7699;
		}
		$var_7700=input('base_color2');
		if($var_7700)
		{
			$var_7696['base_color2']='#'.$var_7700;
		}
		$var_967=input('base_color_t');
		if($var_967)
		{
			$var_7696['base_color_t']='#'.$var_967;
		}
		$var_416=Db::table('ims_sudu8_page_base')->where('uniacid',$var_3044)->count();
		if($var_416>0)
		{
			$var_7701=Db::table('ims_sudu8_page_base')->where('uniacid',$var_3044)->update($var_7696);
		}
		else
		{
			$var_7696['uniacid']=$var_3044;
			$var_7701=Db::table('ims_sudu8_page_base')->insert($var_7696);
		}
		if($var_7701)
		{
			$this->success('基础信息更新成功！');
		}
		else
		{
			$this->error('基础信息更新失败，没有修改项！');
		}
	}
	public function save()
	{
		$var_4988=input('appletid');
		$var_7703=array();
		$var_7703['uniacid']=input('appletid');
		$var_3812=input('index_style');
		if($var_3812)
		{
			$var_7703['index_style']=$var_3812;
		}
		$var_7704=input('tel_box');
		if($var_7704)
		{
			$var_7703['tel_box']=$var_7704;
		}
		else
		{
			$var_7703['tel_box']=0;
		}
		$var_7705=input('aboutCN');
		if($var_7705)
		{
			$var_7703['aboutCN']=$var_7705;
		}
		else
		{
			$var_7703['aboutCN']='';
		}
		$var_613=input('aboutCNen');
		if($var_613)
		{
			$var_7703['aboutCNen']=$var_613;
		}
		else
		{
			$var_7703['aboutCNen']='';
		}
		$var_7706=input('index_about_title');
		if($var_7706|| $var_7706==0)
		{
			$var_7703['index_about_title']=$var_7706;
		}
		else
		{
			$var_7703['index_about_title']=9;
		}
		$var_7707=input('catename_x');
		if($var_7707)
		{
			$var_7703['catename_x']=$var_7707;
		}
		else
		{
			$var_7703['catename_x']='';
		}
		$var_7708=input('catenameen_x');
		if($var_7708)
		{
			$var_7703['catenameen_x']=$var_7708;
		}
		else
		{
			$var_7703['catenameen_x']='';
		}
		$var_7709=input('i_b_x_ts');
		if($var_7709|| $var_7709==0)
		{
			$var_7703['i_b_x_ts']=$var_7709;
		}
		else
		{
			$var_7703['i_b_x_ts']=9;
		}
		$var_7710=input('i_b_x_iw');
		if($var_7710)
		{
			$var_7703['i_b_x_iw']=$var_7710;
		}
		$var_7711=input('catename');
		if($var_7711)
		{
			$var_7703['catename']=$var_7711;
		}
		else
		{
			$var_7703['catename']='';
		}
		$var_7712=input('catenameen');
		if($var_7712)
		{
			$var_7703['catenameen']=$var_7712;
		}
		else
		{
			$var_7703['catenameen']='';
		}
		$var_7713=input('i_b_y_ts');
		if($var_7713|| $var_7713==0)
		{
			$var_7703['i_b_y_ts']=$var_7713;
		}
		else
		{
			$var_7703['i_b_y_ts']=9;
		}
		$var_7714=input('index_pro_lstyle');
		if($var_7714)
		{
			$var_7703['index_pro_lstyle']=$var_7714;
		}
		else
		{
			$var_7703['index_pro_lstyle']=1;
		}
		$var_7715=input('index_pro_ts_al');
		if($var_7715)
		{
			$var_7703['index_pro_ts_al']=$var_7715;
		}
		else
		{
			$var_7703['index_pro_ts_al']='';
		}
		$var_994=input('spcatename');
		if($var_994)
		{
			$var_7703['spcatename']=$var_994;
		}
		else
		{
			$var_7703['spcatename']='';
		}
		$var_7716=input('spcatenameen');
		if($var_7716)
		{
			$var_7703['spcatenameen']=$var_7716;
		}
		else
		{
			$var_7703['spcatenameen']='';
		}
		$var_343=input('sptj_max_sp');
		if($var_343)
		{
			$var_7703['sptj_max_sp']=$var_343;
		}
		else
		{
			$var_7703['sptj_max_sp']=10;
		}
		$var_7717=input('sptj_max');
		if($var_7717)
		{
			$var_7703['sptj_max']=$var_7717;
		}
		else
		{
			$var_7703['sptj_max']=10;
		}
		$var_7718=input('sp_i_b_y_ts');
		if($var_7718)
		{
			$var_7703['sp_i_b_y_ts']=$var_7718;
		}
		else
		{
			$var_7703['sp_i_b_y_ts']=0;
		}
		$var_7719=input('commonuploadpic');
		if($var_7719)
		{
			$var_7703['c_b_bg']=remote($var_4988,$var_7719,2);
		}
		$var_7720=input('c_b_btn');
		if($var_7720)
		{
			$var_7703['c_b_btn']=$var_7720;
		}
		else
		{
			$var_7703['c_b_btn']=0;
		}
		$var_7721=input('duomerchants');
		if($var_7721)
		{
			$var_7703['duomerchants']=$var_7721;
		}
		$var_7722=input('c_title');
		if($var_7722)
		{
			$var_7703['c_title']=$var_7722;
		}
		else
		{
			$var_7703['c_title']=0;
		}
		$var_30=input('form_index');
		if($var_30)
		{
			$var_7703['form_index']=$var_30;
		}
		else
		{
			$var_7703['form_index']=0;
		}
		$var_7723=input('footer_style');
		if($var_7723)
		{
			$var_7703['footer_style']=$var_7723;
		}
		else
		{
			$var_7703['footer_style']='none';
		}
		$var_2451=input('commA');
		$var_7724=input('commAs');
		$var_7725=input('commP');
		$var_7726=input('commPs');
		$var_7727=input('serverBtn');
		if(is_null($var_2451))
		{
			$var_2451=0;
		}
		if(is_null($var_7724))
		{
			$var_7724=0;
		}
		if(is_null($var_7725))
		{
			$var_7725=0;
		}
		if(is_null($var_7726))
		{
			$var_7726=0;
		}
		if(is_null($var_7727))
		{
			$var_7727=1;
		}
		$var_7728=array('newhead' =>input('newhead'),'search' =>input('search'),'bigadT' =>input('bigadT'),'bigadC' =>input('bigadC'),'bigadCTC' =>input('bigadCTC'),'bigadCNN' =>input('bigadCNN'),'miniadT' =>input('miniadT'),'miniadC' =>input('miniadC'),'miniadN' =>input('miniadN'),'miniadB' =>input('miniadB'),'copT' =>input('copT'),'userFood' =>input('userFood'),'commA' =>$var_2451,'commAs' =>$var_7724,'commP' =>$var_7725,'commPs' =>$var_7726,'serverBtn' =>$var_7727);
		$var_7703['config']=serialize($var_7728);
		$var_7729=Db::table('ims_sudu8_page_base')->where('uniacid',$var_4988)->count();
		if($var_7729>0)
		{
			$var_7730=Db::table('ims_sudu8_page_base')->where('uniacid',$var_4988)->update($var_7703);
		}
		else
		{
			$var_7703['uniacid']=$var_4988;
			$var_7730=Db::table('ims_sudu8_page_base')->insert($var_7703);
		}
		if($var_7730)
		{
			$this->success('基础信息更新成功！');
		}
		else
		{
			$this->error('基础信息更新失败，没有修改项！');
		}
	}
	function onepic_uploade($v_1)
	{
		$var_7731=request()->file($v_1);
		if(isset($var_7731))
		{
			$var_7732=upload_img();
			$var_59=$var_7731->validate(['ext'=>'jpg,png,gif,jpeg'])->move($var_7732);
			if($var_59)
			{
				$var_7733=ROOT_HOST.'/upimages/'.date('Ymd',time()).'/'.$var_59->getFilename();
				return $var_7733;
			}
		}
	}
}
?>